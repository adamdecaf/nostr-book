name: Publish Book

on:
  schedule:
    - cron: "0 12 * * *" # "12:00 UTC" - https://crontab.guru/#0_12_*_*_*e
  workflow_dispatch:

jobs:
  publish:
    name: Publish Book
    runs-on: macos-latest
    steps:
    - name: Check out code
      uses: actions/checkout@v4

    - name: Install Dependencies
      run: |
        brew install basictex pandoc

    - name: Download NIPs
      run: |
        make setup
        cd nips/
        git log -n1
        cd ../

    - name: Create books
      run: |
        make all

    - name: Commit and Push
      run: |
        git commit -A nostr-book.*
        git commit -m "chore: automated publishing"
        git push origin master
